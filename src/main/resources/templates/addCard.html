<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	
	<title>Crazy Database</title>
	
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/ui-darkness/jquery-ui.css"/>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
	<link rel="stylesheet" href="css/main.css"/>
	
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
	<div class="container">
		<div class="navbar-header">
			<a class="navbar-brand" href="/" style="background-color: whitesmoke; color: black">Crazy Database</a>
		</div>
	</div>
</nav>
<div class="container">
	<div class="page-header">
		<h1>Add a <span style="color: #ff0000">fake</span> card this CRAZY DATABASE</h1>
		<h2>See lists of <span style="color: red">fake</span> card numbers that will pass the validator<a href="https://www.freeformatter.com/credit-card-number-generator-validator.html"> CLICK</a> and add</h2>
	</div>
	
	
	<h1>Fill this form</h1>
	<form onsubmit="return mySubmitFunction(event)"name="form" style="text-align: center" th:action="@{/card}" th:object="${card}" method="post">
		<div class="form-group">
			<label>Card Number</label>
			<input required = "required" type="text" name="cardNumber" th:maxlength="20" onblur="cardNumberValidation(document.form.cardNumber.value)" th:field="*{cardNumber}" placeholder="Fake Card Number" />
			<a href="https://www.freeformatter.com/credit-card-number-generator-validator.html">Click here to get</a>
		</div>
		
		<div class="form-group">
			<label>Name on Card:</label>
			<input required = "required" type="text" th:field="*{cardOwnerName}" placeholder="Fake Name" />
		</div>
		
		<div class="form-group">
			<label>Cvv</label>
			<input required = "required" type="text" th:field="*{cvv}" th:min="3" th:maxlength="3" placeholder="Fake Security Code" style="width: 130px"/>
			
		</div>
		
		<div class="form-group">
			<label>Card Type</label>
			<select  th:field="*{cardType}">
				<option th:value="'MASTERCARD'" th:text="MASTERCARD"></option>
				<option th:value="'VISA'" th:text="VISA"></option>
				<option th:value="'VERVE'" th:text="VERVE"></option>
			</select>
		</div>
		
		<div class="form-group">
			<label>Bank</label>
			<input required = "required" type="text" th:field="*{bankName}" placeholder="Fake Bank"/>
		</div>
		<p><input type="submit" class="btn btn-primary" value="Add Fake Card" /> <input class="btn btn-primary" type="reset" value="Reset Details"/></p>
	</form>
	
</div>


<script src="http://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script th:inline="javascript">
    let validationValue;
    
    //FINALLY after trials
    let luhnCheck = (function(arr) {
        return function(ccNum) {
            let
                len = ccNum.length,
                bit = 1,
                sum = 0,
                val;

            while (len) {
                val = parseInt(ccNum.charAt(--len), 10);
                sum += (bit ^= 1) ? arr[val] : val;
            }

            return sum && sum % 10 === 0;
        };
    }([0, 2, 4, 6, 8, 1, 3, 5, 7, 9]));

    function cardNumberValidation(cardNumber) {
        if (luhnCheck(cardNumber) === true) {
            validationValue = true;
        } else {
            validationValue = false;
            alert("Not a valid credit/debit card number!");
        }
    }
	
    
    
    
    function submitError() {
        if (validationValue === false){
            alert("Check your credit card number. Make sure its valid then try again");
		}

    }
    function mySubmitFunction(e) {
        if (validationValue === false){
            e.preventDefault();
            submitError();
            return false;
		}else {
            return true;
		}
    
    }
</script>
<script type="text/javascript" th:src="@{js/main.js}"></script>
</body>
</html>